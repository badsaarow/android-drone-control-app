<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta content="width=device-width" name="viewport">
    <link href="./css/joystick.css" rel="stylesheet">
    <script src="./js/joystick.js" type="text/javascript"></script>
    <title>Drone Joystick Controller</title>
    <script>
        function takeOff() {
            fetch(
                "/ctl?takeOff=1"
            ).then((response) => console.log(response));
        }

        function getControl() {
            fetch(
                "/ctl?owner=1"
            ).then((response) => console.log(response));
        }

        function leaveControl() {
            fetch(
                "/ctl?owner=0"
            ).then((response) => console.log(response));
        }

        function saveConfig() {

            config.controls.pitch.axis = +document.getElementById('lxcid').value;
            config.controls.pitch.invert = document.getElementById('lxinvert').checked;
            config.controls.pitch.maxSpeed = +document.getElementById('lxmax').value;

            config.controls.roll.axis = +document.getElementById('lycid').value;
            config.controls.roll.invert = document.getElementById('lyinvert').checked;
            config.controls.roll.maxSpeed = +document.getElementById('lymax').value;

            config.controls.yaw.axis = +document.getElementById('rxcid').value;
            config.controls.yaw.invert = document.getElementById('rxinvert').checked;
            config.controls.yaw.maxSpeed = +document.getElementById('rxmax').value;

            config.controls.throttle.axis = +document.getElementById('rycid').value;
            config.controls.throttle.invert = document.getElementById('ryinvert').checked;
            config.controls.throttle.maxSpeed = +document.getElementById('rymax').value;

            config.sendingDelayMs = +document.getElementById('sendingms').value;

            window.localStorage.setItem('config', JSON.stringify(config));
        }
    </script>
</head>
<body>
<h2 id="start">Press a button on your controller to start</h2>
<ul>pitch: <span id='pitch_val'>0</span></ul>
<ul>roll: <span id='roll_val'>0</span></ul>
<ul>yaw: <span id='yaw_val'>0</span></ul>
<ul>throttle: <span id='throttle_val'>0</span></ul>
<hr/>
<p id="sent">sent command...</p>
<a href="/">Home</a><br>
LeftX Max: <input id="lxmax" max="10.00" min="0.01" step="0.02" style="width: 100px;" type="range" value="1.0"><input
        id="lxcid" max="7" min="0" type="number" value="4"><input  id="lxinvert" type="checkbox"><br/>
LeftY Max: <input id="lymax" max="10.00" min="0.01" step="0.02" style="width: 100px;" type="range" value="1.0"><input
        id="lycid" max="7" min="0" type="number" value="1"><input checked id="lyinvert" type="checkbox"><br/>
RightX Max: <input id="rxmax" max="10.00" min="0.01" step="0.02" style="width: 100px;" type="range" value="1.0"><input
        id="rxcid" max="7" min="0" type="number" value="0"><input id="rxinvert" type="checkbox"><br/>
RightY Max: <input id="rymax" max="10.00" min="0.01" step="0.02" style="width: 100px;" type="range" value="1.0"><input
        id="rycid" max="7" min="0" type="number" value="2"><input checked id="ryinvert" type="checkbox"><br/>
Sending ms: <input id="sendingms" max="500" min="50" step="100" style="width: 100px;" type="range" value="50"><br/>
<button id="getcontrol">Get Control</button>
<button id="leavecontrol">Leave Control</button>
<br>
<button id="takeoff">Take Off</button>
<script>
    document.getElementById('getcontrol').onclick = getControl;
    document.getElementById('leavecontrol').onclick = leaveControl;
    document.getElementById('takeoff').onclick = takeOff;

    document.getElementById('lxcid').onchange = saveConfig;
    document.getElementById('lxcid').value = config.controls.pitch.axis;
    document.getElementById('lxinvert').onchange = saveConfig;
    document.getElementById('lxinvert').checked = config.controls.pitch.invert;
    document.getElementById('lxmax').onchange = saveConfig;
    document.getElementById('lxmax').value = config.controls.pitch.maxSpeed;

    document.getElementById('lycid').onchange = saveConfig;
    document.getElementById('lyinvert').onchange = saveConfig;
    document.getElementById('lyinvert').checked = config.controls.roll.invert;
    document.getElementById('lymax').onchange = saveConfig;
    document.getElementById('lymax').value = config.controls.roll.maxSpeed;

    document.getElementById('rxcid').onchange = saveConfig;
    document.getElementById('rxinvert').onchange = saveConfig;
    document.getElementById('rxinvert').checked = config.controls.yaw.invert;
    document.getElementById('rxmax').onchange = saveConfig;
    document.getElementById('rxmax').value = config.controls.yaw.maxSpeed;

    document.getElementById('rycid').onchange = saveConfig;
    document.getElementById('ryinvert').onchange = saveConfig;
    document.getElementById('ryinvert').checked = config.controls.throttle.invert;
    document.getElementById('rymax').onchange = saveConfig;
    document.getElementById('rymax').value = config.controls.throttle.maxSpeed;

    document.getElementById('sendingms').onchange = saveConfig;
    document.getElementById('sendingms').value = config.sendingDelayMs.value;

</script>
</body>
</html>
